<div class="verdict-form-page">
  <h2 class="page-title">Unos podataka o sluÄaju</h2>

  <!-- Metapodaci -->
  <div class="form-wrapper-left">
    <div class="form-section">
      <h3>Osnovni podaci:</h3>
      <label></label>
      <label>Naziv predmeta:*</label>
      <input [(ngModel)]="metadata.caseName" name="caseName" pattern="^G_\d{1,3}-\d{1,4}$" #caseName="ngModel"
        placeholder="G_123-1234" />

      <label>Datum:*</label>
      <input type="date" [(ngModel)]="metadata.date" name="date" [max]="today" required />

      <label>Sud:*</label>
      <input [(ngModel)]="metadata.court" name="court" required />

      <label>Sudija:*</label>
      <input [(ngModel)]="metadata.judge" name="judge" required />

      <label>ZapisniÄar:*</label>
      <input [(ngModel)]="metadata.clerk" name="clerk" required />

      <label>OptuÅ¾eni:*</label>
      <input [(ngModel)]="metadata.defendant" name="defendant" required />

      <label>OÅ¡teÄ‡eni:*</label>
      <input [(ngModel)]="metadata.injuredParty" name="injuredParty" required />

      <label>TuÅ¾ilac:</label>
      <input [(ngModel)]="metadata.prosecutorAttorney" name="prosecutorAttorney" />

      <label>Branilac:</label>
      <input [(ngModel)]="metadata.defenseAttorney" name="defenseAttorney" />

      <label>Pravni zastupnik:</label>
      <input [(ngModel)]="metadata.legalRepresentative" name="legalRepresentative" />

      <label>VjeÅ¡tak:</label>
      <input [(ngModel)]="metadata.expert" name="expert" />

      <label>UÄesnici:</label>
      <input [(ngModel)]="metadata.participants" name="participants" />

      <label>Organizacije:</label>
      <input [(ngModel)]="metadata.organizations" name="organizations" />
    </div>
  </div>

  <!-- Atributi -->
  <div class="form-wrapper-right">
    <div class="form-section dual-section">
      <!-- LEVA STRANA â€” Pravne Äinjenice -->
      <div class="form-subsection">
        <h3>Pravne Äinjenice:</h3>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.acknowledged" />
          Priznao
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.convicted" /> OsuÄ‘ivan
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.maintenance" />
          IzdrÅ¾avanje Älanova porodice
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.repentance" /> Kajanje
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.previousFamilyIssues" />
          PorodiÄni problemi
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.correctBehavior" />
          Korektno drÅ¾anje
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.injuredCriminalProsecution" />
          OÅ¡teÄ‡eni goni kriviÄno
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.propertyClaim" />
          Imovinsko-pravni zahtjev
        </label>

        <label>
          <input type="checkbox" [(ngModel)]="attributes.intentional" /> Sa
          umiÅ¡ljajem
        </label>

        <label>Materijalno stanje:</label>
        <select id="financialStatus" [(ngModel)]="attributes.financialStatus" class="form-select">
          <option value="Dobro">Dobro</option>
          <option value="Srednje">Srednje</option>
          <option value="Lose">Lose</option>
        </select>

        <label>Tip povrede:</label>
        <select id="injuryType" [(ngModel)]="attributes.injuryType" class="form-select">
          <option value="Nema">Nema</option>
          <option value="Lake">Lake</option>
          <option value="Srednje">Srednje</option>
          <option value="Teske">Teske</option>
          <option value="Dusevne">Dusevne</option>
        </select>

        <label>UraÄunljivost:</label>
        <select id="accountability" [(ngModel)]="attributes.accountability" class="form-select">
          <option value="Uracunljiv">Uracunljiv</option>
          <option value="Smanjena uracunljivost">Smanjena uracunljivost</option>
          <option value="Neuracunljiv">Neuracunljiv</option>
        </select>
      </div>

      <div class="form-subsection">
        <!-- Rasudjivanje po pravilima -->
        <div class="section-separator"></div>

        <!-- ÄŒlan 221 -->
        <p class="rule-title">Nedavanje izdrÅ¾avanja (Äl. 221)</p>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.fails_to_provide_support" />
          Ne daje izdrÅ¾avanje
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.support_duty_legally_established" />
          Obaveza izdrÅ¾avanja je pravno ustanovljena
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.severe_consequences_occurred" />
          Nastupile su teÅ¡ke posledice
        </label>

        <!-- ÄŒlan 222 -->
        <p class="rule-title">KrÅ¡enje porodiÄnih obaveza (Äl. 222)</p>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.violates_family_obligations" />
          KrÅ¡i porodiÄne obaveze
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.family_member_left_in_hardship" />
          ÄŒlan porodice ostavljen u nevolji
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.severe_health_damage_occurred" />
          Nastupila je teÅ¡ka Å¡teta po zdravlje
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.family_member_died" />
          ÄŒlan porodice je umro
        </label>

        <!-- ÄŒlan 216 -->
        <p class="rule-title">VanbraÄna zajednica sa maloletnikom (Äl. 216)</p>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.is_adult" />
          Je punoletno lice
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.lives_in_extramarital_union_with_minor" />
          Å½ivi u vanbraÄnoj zajednici sa maloletnim licem
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.is_parent_or_guardian" />
          Je roditelj ili staratelj
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.enables_minor_extramarital_union" />
          OmoguÄ‡ava maloletnom licu vanbraÄnu zajednicu
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.used_force_threat_or_greed" />
          Upotrebio silu, pretnju ili je voÄ‘en pohlepom
        </label>

        <!-- ÄŒlan 217 -->
        <p class="rule-title">Oduzimanje deteta (Äl. 217)</p>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.unlawfully_handles_child_custody" />
          Nezakonito postupa sa starateljstvom deteta
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.prevents_contact_execution" />
          SpreÄava izvrÅ¡avanje odluke o viÄ‘anju deteta
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.endangered_child_wellbeing" />
          Ugrozio je dobrobit deteta
        </label>

        <!-- ÄŒlan 220 -->
        <p class="rule-title">Nasilje u porodici (Äl. 220)</p>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.commits_domestic_violence" />
          VrÅ¡i nasilje u porodici
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.used_weapon_or_child_present" />
          Upotrebio oruÅ¾je ili u prisustvu deteta
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.caused_severe_injury_or_against_child" />
          Prouzrokovao teÅ¡ku povredu ili protiv deteta
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.family_member_died" />
          ÄŒlan porodice je umro
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="attributes.violates_domestic_violence_protection_order" />
          KrÅ¡i mere zaÅ¡tite od nasilja u porodici
        </label>


      </div>
    </div>
  </div>
  <div>
    <!-- treca kolona: prijedlozi slicnih presuda i ispod dodati rezultate rasudjivanja po pravilima-->

    <div>
      <div class="form-wrapper-right scrollable-column">
        SliÄne presude:
        <ul class="verdict-list" *ngIf="similarVerdicts$ | async as verdicts">
          <ng-container>
            <li *ngFor="let verdict of verdicts" class="verdict-item">
              <a href="#" (click)="openVerdict(verdict.caseName); $event.preventDefault()" class="verdict-link">
                <!--ime presude -->
                <div class="verdict-left">
                  <div class="icon-name">
                    <span class="verdict-icon">ğŸ“„</span>
                    <span class="verdict-name">{{ verdict.caseName }}</span>
                  </div>
                  <div class="verdict-similarity">
                    {{
                    verdict.similarity != null
                    ? (verdict.similarity * 100 | number : "1.2-2")
                    : "0.00"
                    }}%
                  </div>
                </div>

                <!-- pravne cinjenice -->
                <div class="verdict-right">
                  <p class="column-title">Pravne Äinjenice:</p>
                  <div class="verdict-attributes">
                    <p *ngIf="verdict.acknowledged !== undefined">
                      Priznao: {{ verdict.acknowledged ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.convicted !== undefined">
                      OsuÄ‘ivan: {{ verdict.convicted ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.maintenance !== undefined">
                      IzdrÅ¾avanje: {{ verdict.maintenance ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.repentance !== undefined">
                      Kajanje: {{ verdict.repentance ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.previousFamilyIssues !== undefined">
                      Prethodni porodiÄni problemi:
                      {{ verdict.previousFamilyIssues ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.correctBehavior !== undefined">
                      Korektno drÅ¾anje:
                      {{ verdict.correctBehavior ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.injuredCriminalProsecution !== undefined">
                      OÅ¡teÄ‡eni goni kriviÄno:
                      {{ verdict.injuredCriminalProsecution ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.propertyClaim !== undefined">
                      Imovinsko-pravni zahtev:
                      {{ verdict.propertyClaim ? "DA" : "NE" }}
                    </p>
                    <p *ngIf="verdict.intentional !== undefined">
                      Sa umiÅ¡ljajem: {{ verdict.intentional ? "DA" : "NE" }}
                    </p>

                    <p *ngIf="verdict.financialStatus">
                      Materijalno stanje: {{ verdict.financialStatus }}
                    </p>
                    <p *ngIf="verdict.injuryType">
                      Tip povrede: {{ verdict.injuryType }}
                    </p>
                    <p *ngIf="verdict.accountability">
                      UraÄunljivost: {{ verdict.accountability }}
                    </p>

                    <!-- Rasudjivanje po pravilima -->
                    <p *ngIf="verdict.familyObligationsViolation">
                      KrÅ¡enje porodiÄnih obaveza:
                      {{ verdict.familyObligationsViolation }}
                    </p>
                    <p *ngIf="verdict.extramaritalRelationshipMinor">
                      VanbraÄna zajednica sa maloletnikom:
                      {{ verdict.extramaritalRelationshipMinor }}
                    </p>
                    <p *ngIf="verdict.unlawfulDetention">
                      Nezakonito drÅ¾anje Älanova porodice:
                      {{ verdict.unlawfulDetention }}
                    </p>
                    <p *ngIf="verdict.familyMemberMaintenance">
                      Nedavanje izdrÅ¾avanja:
                      {{ verdict.familyMemberMaintenance }}
                    </p>
                    <p *ngIf="verdict.domesticViolence">
                      Nasilje u porodici: {{ verdict.domesticViolence }}
                    </p>
                  </div>
                  <span class="open-icon">ğŸ”—</span>
                </div>
              </a>
            </li>
          </ng-container>
        </ul>
      </div>
    </div>
    <div>
      <div class="form-wrapper-right scrollable-column">
        <!-- Deo za ispis kazni -->
        <div *ngIf="legalAnalysisResult" class="legal-analysis-section">
          <h4>Rezultat pravne analize:</h4>
          <div class="analysis-content">
            <p><strong>OptuÅ¾eni:</strong> {{ metadata.defendant }}</p>
            <p>
              <strong>Kazna:</strong>
              {{ legalAnalysisResult.minSentenceDays }} -
              {{ legalAnalysisResult.maxSentenceDays }} dana ({{
              (legalAnalysisResult.minSentenceDays / 365).toFixed(1)
              }}
              -
              {{ (legalAnalysisResult.maxSentenceDays / 365).toFixed(1) }}
              godina)
            </p>

            <div class="proven-violations">
              <p><strong>Dokazani prekrÅ¡aji:</strong></p>
              <ul>
                <li *ngFor="let violation of legalAnalysisResult.provenViolations">
                  {{ formatViolationName(violation) }}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div *ngIf="isAnalyzing" class="loading-state">
          <p>Analiza u toku...</p>
        </div>
        <div *ngIf="analysisError" class="error-state">
          <p>{{ analysisError }}</p>
        </div>
        <!-- pravne cinjenice -->
        <!--div class="verdict-right">
          <p class="column-title">Pravne Äinjenice:</p>
          <div class="verdict-attributes">
            <p *ngIf="attributes.acknowledged !== undefined">Priznao: {{ attributes.acknowledged ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.convicted !== undefined">OsuÄ‘ivan: {{ attributes.convicted ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.maintenance !== undefined">IzdrÅ¾avanje: {{ attributes.maintenance ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.repentance !== undefined">Kajanje: {{ attributes.repentance ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.previousFamilyIssues !== undefined">Prethodni porodiÄni problemi: {{
              attributes.previousFamilyIssues ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.correctBehavior !== undefined">Korektno drÅ¾anje: {{ attributes.correctBehavior ? 'DA' :
              'NE'
              }}</p>
            <p *ngIf="attributes.injuredCriminalProsecution !== undefined">OÅ¡teÄ‡eni goni kriviÄno: {{
              attributes.injuredCriminalProsecution ? 'DA' : 'NE' }}</p>
            <p *ngIf="attributes.propertyClaim !== undefined">Imovinsko-pravni zahtev: {{ attributes.propertyClaim ?
              'DA' :
              'NE' }}</p>
            <p *ngIf="attributes.intentional !== undefined">Sa umiÅ¡ljajem: {{ attributes.intentional ? 'DA' : 'NE' }}
            </p>
            <p *ngIf="attributes.financialStatus">Materijalno stanje: {{ attributes.financialStatus }}</p>
            <p *ngIf="attributes.injuryType">Tip povrede: {{ attributes.injuryType }}</p>
            <p *ngIf="attributes.accountability">UraÄunljivost: {{ attributes.accountability }}</p>
          </div>
          <span class="open-icon">ğŸ”—</span>
        </div-->
      </div>
    </div>

    <!-- Spinner overlay -->
    <div *ngIf="loading" class="spinner-overlay">
      <mat-progress-spinner mode="indeterminate" diameter="50" color="primary">
      </mat-progress-spinner>
      <p class="loading-spinner">
        Molimo saÄekajte, generisanje moÅ¾e potrajati nekoliko minuta...
      </p>
    </div>

    <div *ngIf="!loading && newVerdictHTML" class="spinner-overlay">
      <button class="fancy-btn" (click)="openCreatedVerdict(newVerdictHTML)">
        Pogledajte presudu
      </button>
    </div>
  </div>
  <div class="actions">
    <button class="fancy-btn" [disabled]="
        !metadata.caseName ||
        caseName.invalid ||
        !metadata.court ||
        !metadata.judge ||
        !metadata.date ||
        !metadata.defendant ||
        !metadata.injuredParty ||
        !metadata.clerk
      " (click)="executeReasoning()">
      âš–ï¸ IZVRÅ AVANJE RASUÄIVANJA âš–ï¸
    </button>

    <button class="fancy-btn" [disabled]="!allowVerdict" (click)="openVerdictCreateForm()">
      ğŸ‘¨â€âš–ï¸ DONESI PRESUDU ğŸ‘¨â€âš–ï¸
    </button>
  </div>
</div>